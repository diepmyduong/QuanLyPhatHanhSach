@using PagedList;
@using PagedList.Mvc;
@model PagedList.IPagedList<Core.BIZ.Sach>

@{
    ViewBag.Title = "Lô nhập";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    int? startMonth = null, startYear = null, endMonth = null, endYear = null;
    if (ViewBag.startDate != null)
    {
        startMonth = ((DateTime)ViewBag.startDate).Month;
        startYear = ((DateTime)ViewBag.startDate).Year;
    }
    if (ViewBag.endDate != null)
    {
        endMonth = ((DateTime)ViewBag.endDate).Month;
        endYear = ((DateTime)ViewBag.endDate).Year;
    }
}

<h2>@ViewBag.Title</h2>
<hr />
<form action="LoNhap" method="GET" class="form-horizontal" role="form">
        <div class="form-group">
            <label for="startDate" class="col-sm-2 control-label">Xem từ tháng :</label>
            <div class="col-sm-2">
                @if (ViewBag.startDate != null)
                {
                    var month = String.Format("{0:yyyy-MM}", (DateTime)ViewBag.startDate);
                    <input type="month" name="startDate" id="startDate" class="form-control" value="@month" required="required" title="">
                }
                else
                {
                    <input type="month" name="startDate" id="startDate" class="form-control" value="" required="required" title="">
                }
                
            </div>
        </div>
        <div class="form-group">
            <label for="endDate" class="col-sm-2 control-label">Đến tháng :</label>
            <div class="col-sm-2">
                @if (ViewBag.endDate != null)
                {
                    var month = String.Format("{0:yyyy-MM}", (DateTime)ViewBag.endDate);
                    <input type="month" name="endDate" id="endDate" class="form-control" value="@month" required="required" title="">
                }
                else
                {
                    <input type="month" name="endDate" id="endDate" class="form-control" value="" required="required" title="">
                }

            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-2 col-sm-offset-2">
                <button type="submit" class="btn btn-primary">Xem</button>
            </div>
        </div>
</form>
<hr />
@if (ViewBag.startDate != null)
{
    using (Html.BeginForm("LoNhap", "ThongKe", FormMethod.Get, new { @class = "form" }))
    {
        @Html.ValidationSummary(true)
        <div class="row ">
            <div class="col-md-10 form-group input-group">
                <input type="search" name="search" id="input" class="form-control"
                       value="@{if (ViewBag.SearchKey != null)
                            {
                                @ViewBag.SearchKey;
                            }
                            }"
                       required="required" title="">
                <span class="input-group-btn"><button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button></span>
            </div>
        </div>
    }
    <table class="table">
        <tr>
            <th>
                @Core.DAL.SachManager.Properties.MaSoSach
            </th>
            <th>
                @Core.DAL.SachManager.Properties.TenSach
            </th>
            <th>
                @Core.DAL.SachManager.Properties.TenTacGia
            </th>
            <th>
                @Core.DAL.SachManager.Properties.LinhVucSach
            </th>
            <th>
                @Core.DAL.SachManager.Properties.NXB
            </th>
            <th>
                @Core.DAL.SachManager.Properties.SoLuongNhapTheoThang
            </th>
            <th>
                @Core.DAL.SachManager.Properties.TongTienNhapTheoThang
            </th>
            <th></th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.MaSoSach)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TenSach)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TenTacGia)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.LinhVucSach.TenLinhVuc)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.NXB.TenNXB)
                </td>
                <td>
                    @String.Format("{0:0}", item.tongSoLuongNhapTheoThang((int)startMonth, (int)startYear, (int)endMonth, (int)endYear))
                </td>
                <td>
                    @String.Format(ViewBag.cultureInfo, "{0:c}", item.tongTienNhapTheoThang((int)startMonth, (int)startYear, (int)endMonth, (int)endYear))
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", "Sach", new { id = item.MaSoSach }, null) |
                    @Html.ActionLink("Details", "LoNhapDetails", new { id = item.MaSoSach })
                </td>
            </tr>
        }

    </table>
    <div class="row">
        <div class="col-md-4 col-md-offset-5">
            @Html.PagedListPager(Model,
                    page => Url.Action("LoNhap",
                        new {
                            page,
                            pageSize = Model.PageSize,
                            search = ViewBag.searchKey,
                            startDate = ViewBag.startDate,
                            endDate = ViewBag.endDate
                        }),
                    PagedListRenderOptions.OnlyShowFivePagesAtATime)
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 col-md-offset-5">
            Showing @Model.FirstItemOnPage to @Model.LastItemOnPage of @Model.TotalItemCount Contents.
        </div>
    </div>
}

